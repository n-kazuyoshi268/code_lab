# **PDF変換API設計書**

## **1. 概要**
本APIは、IPA試験のPDFファイルを読み込み、過去問の問題文・選択肢・正解・解説を抽出し、アプリで扱いやすい形式（JSON）に変換する機能を提供します。

---

## **2. エンドポイント設計**

| エンドポイント       | HTTPメソッド | 説明                                    |
|----------------------|--------------|-----------------------------------------|
| `/convert/pdf`       | POST         | PDFファイルをアップロードし、データを返す|
| `/convert/status`    | GET          | 変換処理のステータスを確認              |

---

## **3. リクエストとレスポンス仕様**

### **3.1 リクエスト仕様**

#### **POST /convert/pdf**

- **Content-Type**: `multipart/form-data`
- **リクエストパラメータ**

| パラメータ名 | 型       | 必須 | 説明              |
|--------------|----------|------|-------------------|
| `file`       | ファイル  | YES  | 変換対象のPDFファイル|

---

### **3.2 レスポンス仕様**

#### **成功時（200 OK）**

```json
{
  "status": "success",
  "data": {
    "questions": [
      {
        "id": 1,
        "year": "2023",
        "type": "PM",
        "question_text": "プロジェクト管理に関する問題",
        "options": {
          "A": "選択肢A",
          "B": "選択肢B",
          "C": "選択肢C",
          "D": "選択肢D"
        },
        "correct_answer": "A",
        "explanation": "プロジェクト管理の基本知識"
      }
    ]
  }
}
```
---

#### **エラー時**

| エラーコード | 説明                                      | サンプルメッセージ                                      |
|--------------|-------------------------------------------|--------------------------------------------------------|
| 400          | 無効なリクエスト                          | `{"status": "error", "message": "無効なPDFファイルです"}`|
| 404          | エンドポイントが見つからない              | `{"status": "error", "message": "指定されたURLは存在しません"}`|
| 413          | ファイルサイズが大きすぎる                | `{"status": "error", "message": "ファイルサイズが上限を超えています"}`|
| 500          | サーバー内部エラー                        | `{"status": "error", "message": "変換処理中にエラーが発生しました"}`|

---

## **4. 変換ロジック**

1. **PDFファイルの読み込み**
   - ライブラリを使用してPDFファイルを読み込み、ページごとにテキストを抽出。
2. **構造解析**
   - 出力されたテキストから、以下の情報を識別・抽出：
     - 問題文  
     - 選択肢（A/B/C/D）  
     - 正解  
     - 解説  
3. **データフォーマット化**
   - 抽出した情報を、以下のJSON形式に変換：
     ```json
     {
       "id": 1,
       "year": "2023",
       "type": "PM",
       "question_text": "プロジェクト管理に関する問題",
       "options": {
         "A": "選択肢A",
         "B": "選択肢B",
         "C": "選択肢C",
         "D": "選択肢D"
       },
       "correct_answer": "A",
       "explanation": "プロジェクト管理の基本知識"
     }
     ```
4. **重複排除**
   - 同一年度・試験種別に対して既に存在するデータを排除し、新規問題のみ追加。

---

